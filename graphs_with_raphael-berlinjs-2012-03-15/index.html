<!doctype html>

<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=1024">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Proper graphing with Raphaël JS</title>

    <link href="css/reset.css" rel="stylesheet" type="text/css">
    <link href='http://fonts.googleapis.com/css?family=Puritan:400,700,400italic,700italic|Ubuntu+Mono:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href="css/cp.css" rel="stylesheet" type="text/css">
    <link href="css/pygments.css" rel="stylesheet" type="text/css">

    <!-- Actually include Raphael / g.raphael -->
    <script src="js/raphael-min.js" type="text/javascript"></script>
    <script src="js/g.raphael-min.js" type="text/javascript"></script>
    <script src="js/g.pie-min.js" type="text/javascript"></script>
    <script src="js/g.line-min.js" type="text/javascript"></script>
    <script src="js/jquery-1.7.1.min.js" type="text/javascript"></script>
</head>
<body>

<div id="impress" class="impress-not-supported">
  <div class="fallback-message">
      <p>This is an impress.js presentation, which needs the most recent Chrome, Safari, or Firefox to work. IE 10+ should work too.</p>
  </div>

  <div id="overview" class="step" data-x="16500" data-y="0" data-scale="33"></div>
  <div id="title" class="step" data-x="2000" data-y="0" data-scale="4">
    <h1 class="slide-head">Proper<br>graphing<br>with<br>Raphaël</h1>
    <p>Matt Patterson</p>
    <p>Constituent Parts</p>
  </div>
  <section>
    <header>
      <h1 class="step" data-x="5500" data-y="" data-scale="3">A quick introduction</h1>
    </header>
    <article class="step" data-x="4500" data-y="1000">
      <h1>Me</h1>
      <p>Web developer, 10+ years JS experience, 6 years Ruby.</p>
      <p>Trained as a Typographer.</p>
    </article>
    <article>
      <h1 class="step" data-x="5500" data-y="1000">Birmingham Civic Dashboard</h1>
      <p class="step" data-x="5500" data-y="1300">Data dashboard showing what Birmingham residents are contacting the council about.</p>
      <p class="step" data-x="5500" data-y="1480">The data comes from their call centres</p>
      <p class="step" data-x="5500" data-y="1600">It's updated every day</p>
      <p class="step" data-x="5500" data-y="1780">A Rails app, deployed on Heroku, using MySQL and MongoDB on the back end. Lots of JS on the front: jQuery, Raphaël...</p>
      <iframe data-x="5500" data-y="2280" class="step" src="http://civicdashboard.org.uk/" scrolling="auto"></iframe>
    </article>
    <article>
      <h1 class="step" data-x="6500" data-y="1000">Raphaël</h1>
      <p class="step" data-x="6500" data-y="1170">Dmitry Baranovskiy’s Javascript vector drawing library.</p>
      <p class="step" data-x="6500" data-y="1350">Presents a single API, but uses either VML (IE), or SVG (everything else).</p>
      <p class="step" data-x="6500" data-y="1500">Raphaël even works in IE 6. IE 6!</p>
    </article>
  </section>
  <section>
    <header>
      <h1 class="step" data-x="8500" data-y="" data-scale="3" data-rotate="180">Javascript graphs</h1>
    </header>
    <article>
      <h1 class="step" data-x="9500" data-y="-1000" data-rotate="180">Other libraries</h1>
      <ul>
        <li class="step" data-x="9500" data-y="-1380" data-rotate="180">
          <p>Specific libraries, like <a href="http://oesmith.github.com/morris.js/">Morris.js</a> for plotting time-series line graphs:</p>
          <p><img class="screengrab" src="images/morris-js.png"></p>
        </li>
        <li class="step" data-x="9500" data-y="-1980" data-rotate="180">
          <p>More general libraries, like <a href="http://github.com/flot/flot">Flot</a>, a jQuery plugin:</p>
          <p><img class="screengrab" src="images/flot.png"></p>
        </li>
        <li class="step" data-x="9500" data-y="-2580" data-rotate="180">
          <p>Libraries, like <a href="http://github.com/flot/flot">D3</a>, which are very powerful but don't work in older browsers:</p>
          <p><img class="screengrab" src="images/d3.png"></p>
        </li>
        <li class="step" data-x="9500" data-y="-2990" data-rotate="180">Libraries like D3 often focus on interactive visualisations which, if you want static or minimally dynamic graphs, is usually overkill</li>
      </ul>
    </article>
    <article>
      <h1 class="step" data-x="8500" data-y="-1000" data-rotate="180">Raphaël</h1>
      <p class="step" data-x="8500" data-y="-1170" data-rotate="180"><a href="http://raphaeljs.com/">raphaeljs.com</a></p>
      <p class="step" data-x="8500" data-y="-1290" data-rotate="180">Has documentation.</p>
      <p class="step" data-x="8500" data-y="-1410" data-rotate="180">If you know what you're looking for, it's pretty good.</p>
      <div class="step highlight" data-x="8500" data-y="-1710" data-rotate="180">
<pre><span class="c1">// Creates canvas 320 × 200 at 10, 50</span>
<span class="kd">var</span> <span class="nx">paper</span> <span class="o">=</span> <span class="nx">Raphael</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">320</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>

<span class="c1">// Creates circle at x = 50, y = 40, with radius 10</span>
<span class="kd">var</span> <span class="nx">circle</span> <span class="o">=</span> <span class="nx">paper</span><span class="p">.</span><span class="nx">circle</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">40</span><span class="p">,</span> <span class="mi">10</span><span class="p">);</span>
<span class="c1">// Sets the fill attribute of the circle to red (#f00)</span>
<span class="nx">circle</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;fill&quot;</span><span class="p">,</span> <span class="s2">&quot;#f00&quot;</span><span class="p">);</span>

<span class="c1">// Sets the stroke attribute of the circle to white</span>
<span class="nx">circle</span><span class="p">.</span><span class="nx">attr</span><span class="p">(</span><span class="s2">&quot;stroke&quot;</span><span class="p">,</span> <span class="s2">&quot;#fff&quot;</span><span class="p">);</span>
</pre>
      </div>
      <div class="step highlight" data-x="8500" data-y="-2180" data-rotate="180">
<pre><span class="nx">paper</span><span class="p">.</span><span class="nx">path</span><span class="p">(</span><span class="s2">&quot;M10,10 L90,90&quot;</span><span class="p">);</span>
<span class="c1">// draw a diagonal line:</span>
<span class="c1">// move to 10,10, line to 90,90</span>

<span class="nx">paper</span><span class="p">.</span><span class="nx">path</span><span class="p">(</span><span class="s2">&quot;M10,10 C50,60 50,50 90,100 90,90&quot;</span><span class="p">)</span>
<span class="c1">// draw a curve</span>
<span class="c1">// move to 10,10, cubic bezier curve to 90,90</span>
<span class="c1">// passing through 50,50</span>

<span class="nx">paper</span><span class="p">.</span><span class="nx">text</span><span class="p">(</span><span class="mi">50</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="s2">&quot;Raphaël\nwrites\ntext&quot;</span><span class="p">);</span>
<span class="c1">// text (\n for newlines...)</span>
</pre>
      </div>
      <ul>
        <li class="step" data-x="8500" data-y="-2485" data-rotate="180">Paths are specified using SVG Path syntax</li>
        <li class="step" data-x="8500" data-y="-2665" data-rotate="180">SVG has a <code class="c1">&lt;polyline&gt;</code> element as well as a <code class="c1">&lt;path&gt;</code> element, but Raphaël hides it all behind <code class="c1">.path()</code>
      </ul>
    </article>
    <article>
      <h1 class="step" data-x="7500" data-y="-1000" data-rotate="180">g.Raphaël</h1>
      <p class="step" data-x="7500" data-y="-1170" data-rotate="180">Official graphing library for Raphaël.</p>
      <div class="step highlight" data-x="7500" data-y="-1380" data-rotate="180">
<pre><span class="nx">paper</span><span class="p">.</span><span class="nx">path</span><span class="p">(</span><span class="s2">&quot;M10,10 L90,90&quot;</span><span class="p">);</span>

<span class="kd">var</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">Raphael</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">640</span><span class="p">,</span> <span class="mi">480</span><span class="p">);</span>
<span class="c1">// Creates pie chart at with center at 320, 200,</span>
<span class="c1">// radius 100 and data: [55, 20, 13, 32, 5, 1, 2]</span>
<span class="nx">r</span><span class="p">.</span><span class="nx">piechart</span><span class="p">(</span><span class="mi">320</span><span class="p">,</span> <span class="mi">240</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="p">[</span><span class="mi">55</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]);</span>
</pre>
      </div>
      <p class="step" data-x="7500" data-y="-1870" data-rotate="180">The docs suck.</p>
      <p class="step" data-x="7500" data-y="-1990" data-rotate="180">(However, it does have some nice label primitives.)</p>
    </article>
  </section>
  <section>
    <article>
      <h1 class="step" data-x="11500" data-y="" data-scale="3">The problem</h1>
    </article>
    <article>
      <h1 class="step" data-x="10500" data-y="1000">You can't always get what you want</h1>
    </article>
    <article>
      <h1 class="step" data-x="11500" data-y="1000">Once you start to care, you can't <em>ever</em> get what you want…</h1>
    </article>
  </section>
  <section>
    <header>
      <h1 class="step" data-x="14500" data-y="" data-scale="3" data-rotate="180">How graphs actually work</h1>
    </header>
    <article>
      <h1 class="step" data-x="15500" data-y="-1000" data-rotate="180">Data</h1>
      <p class="step" data-x="15500" data-y="-1210" data-rotate="180">You need to start with the data. What you're trying to present really needs to govern how you present it.</p>
      <p class="step" data-x="15500" data-y="-1390" data-rotate="180">Bad examples are fun.</p> 
      <div class="step chart pie legend" data-x="15500" data-y="-1390" data-rotate="180" data-z="-1000">
        <table>
          <thead><tr><th>Thing</th><th>Value</th></tr></thead>
          <tbody>
            <tr><td>Car</td><td>16</td></tr>
            <tr><td>Bus</td><td>15</td></tr>
            <tr><td>Bike</td><td>14</td></tr>
            <tr><td>Train</td><td>13</td></tr>
            <tr><td>Pedalo</td><td>12</td></tr>
            <tr><td>Foot</td><td>14</td></tr>
            <tr><td>Kite</td><td>15</td></tr>
          </tbody>
        </table>
        <div class="canvas"></div>
      </div>
      <div class="step chart pie legend" data-x="15500" data-y="-1390" data-rotate="180" data-z="-2000">
        <table>
          <thead><tr><th>Thing</th><th>Value</th></tr></thead>
          <tbody>
            <tr><td>Car</td><td>15</td></tr>
            <tr><td>Bus</td><td>15</td></tr>
          </tbody>
        </table>
        <div class="canvas"></div>
      </div>
      <div class="step chart line legend" data-x="15500" data-y="-1390" data-rotate="180" data-z="-3000">
        <table>
          <thead><tr><th>2000</th><th>2001</th><th>2002</th><th>2003</th><th>2004</th><th>2005</th><th>2006</th><th>2007</th><th>2008</th><th>2009</th></tr></thead>
          <tbody>
            <tr><th>El Salvador</th>
              <td>3446.5</td><td>3446.5</td><td>
                2699.7</td><td>
                3216.7</td><td>
                3733.7</td><td>
                3561.4</td><td>
                3733.7</td><td>
                3274.1</td><td>
                2986.9</td><td>
                4078.3</td><td>
                4078.3</td>
            </tr>
            <tr>
              <th>USA</th>
              <td>17137.6</td><td>
                17449.1</td><td>
                17449.1</td><td>
                17760.7</td><td>
                17137.6</td><td>
                17449.1</td><td>
                17760.7</td><td>
                17449.1</td><td>
                16826.0</td><td>
                15579.6</td><td>
                15579.6</td>
            </tr>
            <tr>
              <th>Deutschland</th>
              <td>1021.3</td><td>
                931.4</td><td>
                955.9</td><td>
                866.0</td><td>
                866.0</td><td>
                866.0</td><td>
                800.7</td><td>
                751.7</td><td>
                719.0</td><td>
                702.6</td><td>
                702.6</td>
            </tr>
          </tbody>
        </table>
        <div class="canvas"></div>
      </div>
      <div class="step chart line legend" data-x="15500" data-y="-1390" data-rotate="180" data-z="-4000">
        <table>
          <thead><tr><th>2000</th><th>2001</th><th>2002</th><th>2003</th><th>2004</th><th>2005</th><th>2006</th><th>2007</th><th>2008</th><th>2009</th></tr></thead>
          <tbody>
            <tr><th>El Salvador</th>
              <td>60</td><td>60</td><td>
                47</td><td>
                56</td><td>
                65</td><td>
                62</td><td>
                65</td><td>
                57</td><td>
                52</td><td>
                71</td><td>
                71</td>
            </tr>
            <tr>
              <th>USA</th>
              <td>5.5</td><td>
                5.6</td><td>
                5.6</td><td>
                5.7</td><td>
                5.5</td><td>
                5.6</td><td>
                5.7</td><td>
                5.6</td><td>
                5.4</td><td>
                5.0</td><td>
                5.0</td>
            </tr>
            <tr>
              <th>Deutschland</th>
              <td>1.25</td><td>
                1.14</td><td>
                1.17</td><td>
                1.06</td><td>
                1.06</td><td>
                1.06</td><td>
                0.98</td><td>
                0.92</td><td>
                0.88</td><td>
                0.86</td><td>
                0.86</td>
            </tr>
          </tbody>
        </table>
        <div class="canvas"></div>
      </div>
      <p class="notes">There’s a pretty good article over at Smashing Magazine about <a href="http://www.smashingmagazine.com/2010/05/10/imagine-a-pie-chart-stomping-on-an-infographic-forever/">bad charts and graphs</a>.</p>
      <p class="step" data-x="15500" data-y="-1540" data-rotate="180">Dynamic charts make the problems much harder to deal with.</p>
    </article>
    <article>
      <h1 class="step" data-x="14500" data-y="-1000" data-rotate="180">The components</h1>
      <div class="step" data-x="14500" data-y="-1400" data-rotate="180">
        <p>There are several basic components:</p>
        <ul>
          <li>Lines: straight, curved, thick, thin</li>
          <li>Shapes: pies, bars, line charts with shaded area, streamgraphs</li>
          <li>Points: size</li>
          <li>Colour: relatedness, contrast</li>
          <li>Scale: context</li>
          <li>Grids: legibility</li>
        </ul>
      </div>
    </article>
    <article>
      <h1 class="step" data-x="13500" data-y="-1000" data-rotate="180">Putting it all together (visually)</h1>
      <ul>
        <li class="step" data-x="13500" data-y="-1170" data-rotate="180">Figure out what your data is trying to say</li>
        <li class="step" data-x="13500" data-y="-1290" data-rotate="180">Figure out what you're trying to say</li>
        <li class="step" data-x="13500" data-y="-1440" data-rotate="180">Figure out what the usual ranges you're going to be dealing with are</li>
        <li class="step" data-x="13500" data-y="-1590" data-rotate="180">Test for brokenness at the extremes</li>
      </ul>
    </article>
  </section>
  <section>
    <header>
      <h1 class="step" data-x="18500" data-y="" data-scale="3">Raphaël primitives</h1>
    </header>
    <article>
      <h1 class="step" data-x="17500" data-y="1000">Paths</h1>
      <p class="step" data-x="17500" data-y="1170"><code>var p = paper.path();</code></p>
      <p class="step" data-x="17500" data-y="1320">Attributes of the path are set with <code>attr()</code>, e.g. <code>p.attr({fill: "blue"})</code>.</p>
      <p class="step" data-x="17500" data-y="1500">Terrifyingly, the SVG path spec is your friend here.</p>
      <p class="step" data-x="17500" data-y="1620">Moves, Lines, Curves (&amp; closing paths)</p>
      <p class="step" data-x="17500" data-y="1740">It's a lot like PostScript (or Logo)</p>
      <div class="step pathdemo" data-x="17500" data-y="2300">
      </div>
    </article>
    <article>
      <h1 class="step" data-x="18500" data-y="1000">Shapes</h1>
      <p class="step" data-x="18500" data-y="1170"><code>var c = paper.circle();</code></p>
      <p class="step" data-x="18500" data-y="1290"><code>var r = paper.rect();</code></p>
      <div class="step shapedemo" data-x="18500" data-y="1800"></div>
    </article>
    <article>
      <h1 class="step" data-x="19500" data-y="1000">Sets & Elements</h1>
      <p class="step" data-x="19500" data-y="1200"><code>attr()</code>, and the majority of other functionality, comes from <code>Element</code></p>
      <p class="step" data-x="19500" data-y="1410">It's a very sensible, and powerful thing: Almost everything can be operated on in the same way.</p>
      <p class="step" data-x="19500" data-y="1590">Sets make use of that.</p>
      <p class="step" data-x="19500" data-y="1800">A set is a bit like an Array or Hash. The magic is that you can call Element methods on it, and those methods will be applied to all its members.</p>
      <div class="step setdemo" data-x="19500" data-y="2700"></div>
    </article>
  </section>
  <section>
    <header>
      <h1 class="step" data-x="24500" data-y="" data-scale="3" data-rotate="180">Strategies</h1>
    </header>
    <article>
      <h1 div class="step" data-x="23500" data-y="-1000">Value Objects</h1>
    </article>
    <div>
      <h1 class="step" data-x="24500" data-y="-1000">Sets</h1>
    </div>
    <div class="step" data-x="25500" data-y="-1000">
      <h1>Design...</h1>
    </div>
  </section>
  <div class="step-group">
    <div class="step" data-x="27500" data-y="" data-scale="3">
      <h1>Getting the data in</h1>
    </div>
  </div>
  <div class="step" data-x="30500" data-y="" data-scale="3">
    <h1>Questions?</h1>
  </div>
  <div class="step" data-x="33500" data-y="" data-scale="3">
    <h1>Credits</h1>
  </div>
</div>

<script language="javascript" type="text/javascript" src="js/impress.js"></script>
<script language="javascript">
  var pathdemo, shapedemo, setdemo;
  impress();
  $(function() {
    //  chart pie legend
    $('div.chart.pie').each(function() {
      var chart = this,
          canvas = $(chart).find('div.canvas'),
          paper = Raphael(canvas[0], 600, 400),
          values = [],
          labels = [];
      $(this).find('table tbody tr').each(function() {
        values.push(parseInt($(this).find('td:last').text()));
        if ($(chart).hasClass('legend')) {
          labels.push($(this).find('td:first').text());
        }
      });
      paper.piechart(300, 200, 150, values, {legend: labels});
    });
    // chart line
    $('div.chart.line').each(function() {
      var chart = this,
          canvas = $(chart).find('div.canvas'),
          paper = Raphael(canvas[0], 600, 400),
          y_values = [],
          x_values = [],
          base_x_values = [],
          line_i = 0,
          values;
      $(this).find('table thead tr th').each(function() {
        base_x_values.push(parseInt($(this).text()));
      });
      $(this).find('table tbody tr').each(function() {
        values = [];
        $(this).find('td').each(function() {
          values.push($(this).text());
        });
        y_values[line_i] = values;
        line_i++;
      });
      for(var i=0; i < line_i; i++) {
        x_values.push(base_x_values.concat([]));
      }
      paper.linechart(50, 50, 500, 300, x_values, y_values, {axis: "0,0,1,1"});
    });
    $('.pathdemo').each(function() { var dc = $('<div class="democanvas"></div>'); dc.appendTo($(this)); pathdemo = Raphael(dc[0], 800,600); });
    $('.shapedemo').each(function() { var dc = $('<div class="democanvas"></div>'); dc.appendTo($(this)); shapedemo = Raphael(dc[0], 800,600); });
    $('.setdemo').each(function() { var dc = $('<div class="democanvas"></div>'); dc.appendTo($(this)); setdemo = Raphael(dc[0], 800,600); });
  });
</script>
</body>
</html>
